<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>The many flavors of mappings</title>
      <style type="text/css">
        @import url("../style/tigris.css");
        @import url("../style/maven.css");
    .dtd-comment {
      color: #993399;
      font-weight: bold;
      </style>
      <script type="text/javascript">
        if (document.layers) {
          document.writeln('<link rel="stylesheet" type="text/css" href="../style/ns4_only.css" media="screen" /><link rel="stylesheet" type="text/css" href="../style/maven_ns4_only.css" media="screen" />')
        }
      </script>
      <link rel="stylesheet" type="text/css" href="../style/print.css" media="print" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</head>
<body class="composite">
<div id="banner">
<table border="0" cellspacing="0" cellpadding="8" width="100%">
  <tbody>
    <tr>
      <td><h1>The many flavors of mappings</h1>
      </td>
      <td>
      <div align="right" id="login"><a href="http://sourceforge.net">
      <img src="http://sourceforge.net/sflogo.php?group_id=69358&amp;type=5"
        width="210" height="62" border="0" alt="SourceForge.net Logo"></a></div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div id="breadcrumbs">
<table border="0" cellspacing="0" cellpadding="4" width="100%">
  <tbody>
    <tr>
      <td>
        <div align="right">
          <a href="../index.html">Home Page</a> |
          <a href="http://www.sourceforge.net/projects/jibx/">SourceForge Page</a> |
          <a href="../mail-lists.html">Mailing Lists</a> |
          <a href="http://wiki.jibx.org">Wiki</a> |
          <a href="../bugs.html">Bugs</a> |
          <a href="http://sourceforge.net/project/showfiles.php?group_id=69358">Downloads</a>
        </div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<table border="0" cellspacing="0" cellpadding="8" width="100%" id="main">
  <tbody>
	<tr valign="top">
	  <td id="leftcol" width="20%">
		<div id="navcolumn">


                  <div>
            <strong>JiBX Basics</strong>
                              <div>
            <small>
                    <a href="../index.html">Overview</a>
                  </small>
                              <div>
            <small>
                    <a href="../flexibility.html">Flexibility</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../performance.html">Performance</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../clean-code.html">Clean code</a>
                  </small>
                </div>
                      </div>
                                    <div>
            <small>
                    <a href="../status.html">News and Status</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../comments.html">User Comments</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../bugs.html">Bugs</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../start.html">Getting Started</a>
                  </small>
                              <div>
            <small>
                    <a href="binding-tutorial.html">Binding Tutorial</a>
                  </small>
                              <div>
            <small>
                    <a href="binding-start.html">A basic binding</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-extras.html">Binding extras</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-structures.html">Structure mapping</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-collects.html">Collections</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <span class="menu-selection">Using mappings</span>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-advanced.html">Advanced binding</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-extend.html">Method hooks</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-custom.html">Custom code</a>
                  </small>
                </div>
                      </div>
                                    <div>
            <small>
                    <a href="../bindcomp.html">Binding Compiler</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../bindonload.html">Binding on Load</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../runtime.html">Runtime</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../extras.html">JiBX Extras</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../building.html">Building JiBX</a>
                  </small>
                </div>
                      </div>
                                    <div>
            <small>
                    <a href="../schema.html">Schema Compatibility</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../mail-lists.html">Mailing Lists</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../faq.html">FAQ</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../contributing.html">Contributing</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../jibx-license.html">License</a>
                  </small>
                </div>
                      </div>
                        <div>
            <strong>Binding Definition</strong>
                              <div>
            <small>
                    <a href="../details/binding-overview.html">Definition details</a>
                  </small>
                              <div>
            <small>
                    <a href="../details/contexts.html">Definition contexts</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/conversions.html">Conversions</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/xml-summary.html">XML summary</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/binding-element.html">&lt;binding&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/include-element.html">&lt;include&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/format-element.html">&lt;format&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/namespace-element.html">&lt;namespace&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/mapping-element.html">&lt;mapping&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/value-element.html">&lt;value&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/structure-element.html">&lt;structure&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/collection-element.html">&lt;collection&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/binding-attributes.html">Attribute groups</a>
                  </small>
                </div>
                      </div>
                      </div>
                        <div>
            <strong>Usage API</strong>
                              <div>
            <small>
                    <a href=".././api/index.html">Runtime JavaDocs</a>
                  </small>
                </div>
                      </div>
                        <div>
            <strong>Subprojects</strong>
                              <div>
            <small>
                    <a href="../jibxtools/index.html">Generator Tools</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../jibxsoap/index.html">JibxSoap</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../siteamatic/index.html">SiteAMatic</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../xsd2jibx/index.html">Xsd2Jibx</a>
                  </small>
                </div>
                      </div>
      

        </div>
      </td>
      <td>


      <div id="bodycol">
      <div class="app">
      <div class="h3">
      <h3><a name="normal">Normal mappings</a></h3>

<p>You can define multiple <b>mapping</b>s within a single binding, as already
demonstrated in the last <a href="binding-collects.html#figure10">collections examples</a>. These
mappings may all be top-level (children of the <b>binding</b> element), or may
be nested within other <b>mapping</b> definitions. Nested <b>mapping</b>
definitions are only usable within the context of
the containing <b>mapping</b>. In general, it's not a good idea to nest mapping
definitions more than one level deep, or inside mappings other than the one used
for the root element of your documents, because of performance concerns.</p>

<p><a href="#figure12">Figure 12</a> is a trivial example of using multiple
mappings. The first <b>mapping</b> in this example binds the root <b>customer</b>
element to the <code>Customer</code> class. The second
<b>mapping</b>, highlighted in green, binds <b>address</b> elements to the
<code>Address</code> class. The empty <b>structure</b> element (with no child
elements) for the <code>address</code> field, both shown in blue, automatically
uses the mapping defined for the <code>Address</code> class because that is the
type of the field referenced by the <b>structure</b> element.</p>

<a name="figure12"><b>Figure 12. Normal multiple mapping example</b></a><br>
<img src="images/mapping-normal.gif" width="548" height="360" alt="Normal multiple mapping example"/>

<p>Using empty <b>structure</b> elements to reference mappings, as shown in
<a href="#figure12">Figure 12</a>, is most useful when an object reference can
be to instances of different classes. When there's no <b>mapping</b> defined for
the exact type of the object reference associated with the structure, but there
are one or more mappings for assignment-compatible types (such as subclasses),
JiBX will accept any of the assignment-compatible types at runtime and use the
appropriate mapping.</p>

<p><a href="#figure13">Figure 13</a> demonstrates using an empty
<b>structure</b> element with no <b>mapping</b> matching the object type. The
only change from the last example is that I changed
the type of the <code>address</code> field to <code>java.lang.Object</code>
(highlighted in green). The same document is still marshalled and unmarshalled,
but there is a subtle difference between the two examples: The
<a href="#figure13">Figure 13</a> binding will allow the <code>address</code>
field to reference an instance of <i>any</i> mapped class, including another
instance of the <code>Customer</code> class. This flexibility may not be what
we want in this case (since the field is named "address"), but it fits the field
definition.</p>

<a name="figure13"><b>Figure 13. Multiple mapping with generic reference</b></a><br>
<img src="images/mapping-generic.gif" width="548" height="288" alt="Multiple mapping with generic reference"/>

<p>You can force an empty <b>structure</b> element to use a particular
<b>mapping</b> with the <b>map-as</b> attribute. This restricts the value for
the referenced object to always be of the type of that mapping. It's generally a
good idea to use <b>map-as</b> when you're expecting to use a specific mapping,
even when JiBX will automatically select that mapping (as in
<a href="#figure12">Figure 12</a>), just to make the linkage to a
particular <b>mapping</b> explicit and avoid any potential confusion. I'll show
some examples of using the <b>map-as</b> attribute later on this page.</p>

      </div>
      <div class="h3">
      <h3><a name="abstract">Abstract mappings</a></h3>

<p>All the <b>mapping</b> examples I've used so far are normal mappings, each
relating an element name to instances of a particular class. JiBX also lets you
define abstract mappings, which are essentially anonymous bindings for classes.
Abstract mappings can be referenced from different contexts with different
element names, or with no name at all. <a href="#figure14">Figure 14</a> shows
an example using an abstract mapping.</p>

<a name="figure14"><b>Figure 14. Simple abstract mapping</b></a><br>
<img src="images/mapping-abstract.gif" width="570" height="422" alt="Simple abstract mapping"/>

<p>This binding defines normal mappings for two classes, the <code>Customer</code>
class and the <code>Subscriber</code> class. The abstract mapping for the
<code>Address</code> class, highlighted in blue, defines the basic XML structure
used to represent an address. The <code>Customer</code> mapping includes a pair
of <b>structure</b> elements (highlighted in green and red) that define
element names for the two <code>Address</code> components of a customer, so
within the corresponding <b>customer</b> element these components are each bound
to separate child elements. The <code>Subscriber</code> mapping uses a single
<b>structure</b> element (highlighted in magenta) with no element name for its
<code>Address</code> component, so the address information is in this case
merged directly into the representation of the corresponding <b>subscriber</b>
element.</p>

<p>You can define multiple abstract mappings for the same class, using names to
distinguish between the mappings. <a href="#figure15">Figure 15</a> shows a
modified version of the last example, where I've defined two different abstract
mappings for the <code>Address</code> class. The first abstract mapping,
highlighted in blue, is the same as the <code>Address</code> mapping in the
last example except for the addition of a <b>type-name</b> of "normal-address".
The second abstract mapping, highlighted in green, uses a different structure
and a <b>type-name</b> of "compact-address". Each <b>structure</b> reference to
a <code>Address</code> object has also been changed, as highlighted in magenta,
to reference one of the two abstract mapping names using a <b>map-as</b>
attribute.</p>

<a name="figure15"><b>Figure 15. Named abstract mappings</b></a><br>
<img src="images/mapping-typenames.gif" width="588" height="470" alt="Named abstract mappings"/>

<p>The <a href="#figure15">Figure 15</a> changes have no effect on the document
with the <b>customer</b> root element, since the abstract mapping used for the
<code>Address</code> instances in this context remains the same. But the
document with the <b>subscription</b> root element has a very different
structure from the previous example, as defined by the alternative abstract
mapping for the <code>Address</code> class.</p>

<p>You can use interfaces as well as regular classes for abstract mappings,
which is useful when the interface defines get/set methods to be used by the
mapping. You can also use interfaces and abstract classes with a normal mapping
definition in some circumstances - the basic requirement here is that there has
to be a way to create an instance of the interface or abstract class when
unmarshalling (as with a <b>factory</b> method, discussed in <a
href="binding-extend.html#extmeths">User extension method hooks</a>).</p>

      </div>
      <div class="h3">
      <h3><a name="inherit">Mappings and inheritance</a></h3>

<p>Besides the "free standing" mappings you've seen so far, you can also define
extension mappings which are linked to other mappings. Each extension mapping
references some base mapping. By attaching itself to that base mapping, the
extension mapping becomes an alternative to the base mapping anywhere the base
mapping is invoked in the binding.</p>

<p>Extension mappings were originally intended to be used in representing
polymorphic class structures, where different subclasses of some base class can
be used interchangeably. They work especially well in the case where the base
class is never used directly - in this case you can define an abstract mapping
for the root class of the hierarchy, then add normal mappings which
extend that abstract mapping for each subclass you want to include in your
binding. <a href="#figure16">Figure 16</a> shows a simple example of this
approach.</p>

<a name="figure16"><b>Figure 16. Abstract and extension mappings</b></a><br>
<img src="images/mapping-extends.gif" width="564" height="412" alt="Subclasses without extension mappings"/>

<p>Here I've changed my earlier example code to support two types of customers,
persons and companies. The <code>Customer</code> class doesn't care which is
used, it just includes a reference to an instance of the <code>Identity</code>
class. The <code>Identity</code> itself only defines a customer number. The
<code>Person</code> and <code>Company</code> classes each extend
<code>Identity</code> with added information for their particular type.</p>

<p>I've highlighted the handling of the base <code>Identity</code> class in blue
in <a href="#figure16">Figure 16</a>, with the <code>Person</code> handling
in green and the <code>Company</code> extension in magenta. The <b>mapping</b>
definitions for the subclasses each invoke the base class abstract mapping as
part of their bindings (using a <b>&lt;structure map-as="..."></b> reference).
This can be done at any point in the definitions (or even skipped completely, if
you don't want to use the base class mapping at all). The
<code>Person</code> mapping invokes the base class mapping as the very first
step in the definition, so in this case the XML representation has the base
class information before the subclass information. The <code>Company</code>
mapping reverses this sequence.</p>

<p>The base for an extension mapping doesn't have to be an abstract mapping.
It's generally easiest to structure your extensions to use an abstract base when
you can, but there are cases where that's just not possible. For example, if
instances of your base class can be used directly (rather than only instances of
subclasses), you need to define a concrete mapping for that root class.
<a href="#figure17">Figure 17</a> gives an example of this situation.</p>

<a name="figure17"><b>Figure 17. Extending a concrete mapping</b></a><br>
<img src="images/mapping-extends2.gif" width="580" height="483" alt="Extending a concrete mapping"/>

<p>The difference from the last example is that in
<a href="#figure17">Figure 17</a> the base <code>Identity</code> class can be
used directly, as shown by the added example document (highlighted in magenta).
Since the base class can be used directly I had to define a concrete mapping
for the class, and make the subclass mappings extend the base mapping
(highlighted in green). I couldn't just invoke this base class mapping in the
subclass mappings, though, since the base mapping includes the <b>base-ident</b>
element name - invoking it directly would correspond to an XML structure where
the entire <b>base-ident</b> element was embedded within the subclass
representations. Instead, I used a separate named abstract mapping to represent
the structure I wanted for the base class information, and invoked this abstact
mapping from both the base mapping and the subclass mappings.</p>

<p>Even though the original intention of extension mappings was to represent
polymorphism, they can also be used in other circumstances - there's no
requirement that the classes handled by the extension mappings have any
particular inheritance or implements relationship to the class handled by the
base mapping. This flexibility can be useful when working with XML
representations which assume a particular inheritance structure (in the form of
substitution groups) that doesn't match the intent of your application
code.</p>

<p>This page covers most of the <b>mapping</b> element options and usage, but
see the <a href="../details/mapping-element.html">&lt;mapping> element</a> details page for full
details.</p>

<div><p align="center"><a href="binding-advanced.html"><b>Next: Advanced binding features</b></a></p></div>

      </div>
      </div>
      </div>


      </td>
    </tr>
  </tbody>
</table>
<div id="footer">
<table border="0" cellspacing="0" cellpadding="4">
  <tbody>
    <tr>
      <td> &copy; 2003-2006, Dennis M. Sosnoski (<a href="http://www.sosnoski.com">Sosnoski Software Solutions, Inc.</a>).
      Licensed to the JiBX Project for free distribution and use. </td>
    </tr>
  </tbody>
</table>
</div>
<br>
</body>
</html>
