<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Working with collections and IDs</title>
      <style type="text/css">
        @import url("../style/tigris.css");
        @import url("../style/maven.css");
    .dtd-comment {
      color: #993399;
      font-weight: bold;
      </style>
      <script type="text/javascript">
        if (document.layers) {
          document.writeln('<link rel="stylesheet" type="text/css" href="../style/ns4_only.css" media="screen" /><link rel="stylesheet" type="text/css" href="../style/maven_ns4_only.css" media="screen" />')
        }
      </script>
      <link rel="stylesheet" type="text/css" href="../style/print.css" media="print" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</head>
<body class="composite">
<div id="banner">
<table border="0" cellspacing="0" cellpadding="8" width="100%">
  <tbody>
    <tr>
      <td><h1>Working with collections and IDs</h1>
      </td>
      <td>
      <div align="right" id="login"><a href="http://sourceforge.net">
      <img src="http://sourceforge.net/sflogo.php?group_id=69358&amp;type=5"
        width="210" height="62" border="0" alt="SourceForge.net Logo"></a></div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div id="breadcrumbs">
<table border="0" cellspacing="0" cellpadding="4" width="100%">
  <tbody>
    <tr>
      <td>
        <div align="right">
          <a href="../index.html">Home Page</a> |
          <a href="http://www.sourceforge.net/projects/jibx/">SourceForge Page</a> |
          <a href="../mail-lists.html">Mailing Lists</a> |
          <a href="http://wiki.jibx.org">Wiki</a> |
          <a href="../bugs.html">Bugs</a> |
          <a href="http://sourceforge.net/project/showfiles.php?group_id=69358">Downloads</a>
        </div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<table border="0" cellspacing="0" cellpadding="8" width="100%" id="main">
  <tbody>
	<tr valign="top">
	  <td id="leftcol" width="20%">
		<div id="navcolumn">


                  <div>
            <strong>JiBX Basics</strong>
                              <div>
            <small>
                    <a href="../index.html">Overview</a>
                  </small>
                              <div>
            <small>
                    <a href="../flexibility.html">Flexibility</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../performance.html">Performance</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../clean-code.html">Clean code</a>
                  </small>
                </div>
                      </div>
                                    <div>
            <small>
                    <a href="../status.html">News and Status</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../comments.html">User Comments</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../bugs.html">Bugs</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../start.html">Getting Started</a>
                  </small>
                              <div>
            <small>
                    <a href="binding-tutorial.html">Binding Tutorial</a>
                  </small>
                              <div>
            <small>
                    <a href="binding-start.html">A basic binding</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-extras.html">Binding extras</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-structures.html">Structure mapping</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <span class="menu-selection">Collections</span>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-mappings.html">Using mappings</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-advanced.html">Advanced binding</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-extend.html">Method hooks</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="binding-custom.html">Custom code</a>
                  </small>
                </div>
                      </div>
                                    <div>
            <small>
                    <a href="../bindcomp.html">Binding Compiler</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../bindonload.html">Binding on Load</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../runtime.html">Runtime</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../extras.html">JiBX Extras</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../building.html">Building JiBX</a>
                  </small>
                </div>
                      </div>
                                    <div>
            <small>
                    <a href="../schema.html">Schema Compatibility</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../mail-lists.html">Mailing Lists</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../faq.html">FAQ</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../contributing.html">Contributing</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../jibx-license.html">License</a>
                  </small>
                </div>
                      </div>
                        <div>
            <strong>Binding Definition</strong>
                              <div>
            <small>
                    <a href="../details/binding-overview.html">Definition details</a>
                  </small>
                              <div>
            <small>
                    <a href="../details/contexts.html">Definition contexts</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/conversions.html">Conversions</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/xml-summary.html">XML summary</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/binding-element.html">&lt;binding&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/include-element.html">&lt;include&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/format-element.html">&lt;format&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/namespace-element.html">&lt;namespace&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/mapping-element.html">&lt;mapping&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/value-element.html">&lt;value&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/structure-element.html">&lt;structure&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/collection-element.html">&lt;collection&gt; element</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../details/binding-attributes.html">Attribute groups</a>
                  </small>
                </div>
                      </div>
                      </div>
                        <div>
            <strong>Usage API</strong>
                              <div>
            <small>
                    <a href=".././api/index.html">Runtime JavaDocs</a>
                  </small>
                </div>
                      </div>
                        <div>
            <strong>Subprojects</strong>
                              <div>
            <small>
                    <a href="../jibxtools/index.html">Generator Tools</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../jibxsoap/index.html">JibxSoap</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../siteamatic/index.html">SiteAMatic</a>
                  </small>
                </div>
                                    <div>
            <small>
                    <a href="../xsd2jibx/index.html">Xsd2Jibx</a>
                  </small>
                </div>
                      </div>
      

        </div>
      </td>
      <td>


      <div id="bodycol">
      <div class="app">
      <div class="h3">
      <h3><a name="collects">Working with collections</a></h3>

<p>Besides working with individual objects, applications often need to deal with
collections of objects. <a href="#figure8">Figure 8</a> gives a simple example
of using collections with JiBX. Here the classes represent the basics of an
airline flight timetable, which I'll expand on for the next examples. In this
example I'm only using a pair of collections in the root <code>TimeTable</code>
object, one representing carriers (airlines) and the other airports.</p>

<a name="figure8"><b>Figure 8. Basic collection handling</b></a><br>
<img src="images/collection-binding1.gif" width="594" height="398" alt="Basic collection handling"/>

<p>The <a href="#figure8">Figure 8</a> binding definition uses a
<b>collection</b> element for each collection, with a nested <b>structure</b>
element to provide the details of the items present in the collection. I've
highlighted the definitions for the collection of carriers in green, and the
actual carrier information in blue. The collection of airports is handled in the
same way as the collection of carriers.</p>

<p>In the case of the <a href="#figure8">Figure 8</a> binding the collections
are homogeneous, with all items in each collection of a particular type. You can
also define heterogeneous collections, consisting of several types of items, by
just including more than one <b>structure</b> element as a child of the
<b>collection</b> element. <a
href="#figure9">Figure 9</a> demonstrates using a heterogeneous collection for
the same data as in <a href="#figure8">Figure 8</a>, with the <b>structure</b>
definitions for the carrier and airport components (shown in green) combined in
a single collection.</p>

<a name="figure9"><b>Figure 9. Heterogeneous collection, with factory</b></a><br>
<img src="images/collection-binding1a.gif" width="568" height="372" alt="Heterogeneous collection, with factory"/>

<p><a href="#figure9">Figure 9</a> also demonstrates the easiest way to work with
collection interfaces (shown in blue). I've changed the type of the collection field in the
<code>TimeTable</code> class to the <code>List</code> interface, rather than the
concrete <code>ArrayList</code> class used in <a href="#figure8">Figure 8</a>.
I've also added the <code>listFactory()</code> method, which returns an instance
of a <code>List</code> interface. Finally, I added a <b>factory</b> attribute on
the binding definition <b>collection</b> element to specify the factory method.
When a factory method is given, JiBX calls that method to get a new instance of
the class if it needs one during unmarshalling. JiBX will reuse an existing
instance if one is already present, so the method is only called if the current
value of the field is <code>null</code> (though when reusing a collection, you
need to "manually" empty the collection before unmarshalling - a
<a href="binding-extend.html#extmeths"><b>pre-set</b> method</a> works well for this
purpose).</p>

<p>The <b>factory</b> attribute can also be used for other types of objects
besides collections (see <a href="binding-extend.html#extmeths">User extension
method hooks</a> for full details on this and other ways of using your own
code with JiBX). It comes in especially useful with collections, though,
since application code often uses interfaces such as <code>java.util.List</code>
rather than concrete collection classes. For convenience, JiBX supplies the
<code>org.jibx.runtime.Utility.arrayListFactory()</code> method as a predefined
factory you can use for <code>List</code> instances. You can also define your
own factory methods returning any type of implementation class you want,
as shown in the <a href="#figure9">Figure 9</a> example.</p>

<p>As with <b>structure</b> elements with multiple child components,
heterogeneous collections can be either ordered (meaning the items of each type
may be repeated, but the different types of items must always occur in the
specified order) or unordered (meaning the items can be in any order). The child
components of a collection are always treated as optional by JiBX (so zero or
more instances are accepted), but for consistency with the other parent elements
that allow <b>ordered="false"</b> you still need to specify
<b>usage="optional"</b> on the child components of an unordered collection.</p>

<p>The <b>collection</b> element is generally similar to the <b>structure</b>
element in usage and options, but accepts some additional attributes that are
unique to working with collections of items. Most of the added attributes are
for when you want to implement a custom form of collection, using your own
methods to add and retrieve items in the collection. Another attribute,
<b>item-type</b>, can be used to specify the type of items in the
collection.</p>

<p>For the prior examples I've used embedded <b>structure</b> elements to define
the structure of items in the collection. This isn't the only way to use
collections, though. You can instead leave a <b>collection</b> element empty to
tell the binding compiler that objects in the collection will have their own
<b>mapping</b> definitions. Specifying the type of items can be useful in this
case to avoid ambiguity. <a href="#figure10">Figure 10</a> shows an example of
using mapping definitions in this way.</p>

<a name="figure10"><b>Figure 10. Collections with mappings</b></a><br>
<img src="images/collection-binding1b.gif" width="536" height="334" alt="Collections with mappings"/>

<p>In <a href="#figure10">Figure 10</a> I've converted the embedded carrier and
airport <b>structure</b> definitions used in the earlier examples into their own
<b>mapping</b> elements. The binding uses an <b>item-type</b> attribute to
specify that the first collection (shown in blue) contains only carriers, while
the second collection (shown in green) uses a generic <code>Object</code>
array for the airport information. In this example, if I didn't specify the type
of items present in the first collection JiBX wouldn't know when to stop adding
unmarshalled items to the first collection and start adding them to the second
collection. Using the <b>item-type</b> attribute makes it clear that the first
collection is only intended for <code>Carrier</code> instances.</p>

<p>The <b>collection</b> element will work with all standard Java collections
implementing the <code>java.util.Collection</code> interface. You can also use
arrays of both object and primitive types. The defined type of the array is
assumed as the type of the items in the collection, as in the <a
href="#figure10">Figure 10</a> example, but you can override this to a more
specific type by using the <b>item-type</b> attribute. In the case of
simple values (primitives, or objects which are represented as simple text
strings), you just use one or more nested <b>value</b> elements (which must
use <b>style="element"</b>, directly or by default) instead of <b>structure</b>
elements. You can even nest collections inside other collections.</p>

<p>See the <a href="../details/collection-element.html">&lt;collection> element</a> details page for
full details on the collection options and usage.</p>

      </div>
      <div class="h3">
      <h3><a name="ids">Working with IDs</a></h3>

<p><a href="#figure11">Figure 11</a> gives a more complex example of working with
collections. This builds on the <a href="#figure10">Figure 10</a> XML and data
structures. The prior collections of <b>carrier</b> and <b>airport</b> elements
are still present, but now the XML representation uses wrapper elements
(<b>carriers</b> and <b>airports</b>, respectively) for the collections of each
type. The blue highlighting in the diagram shows this change. In the binding
definition, the addition of the wrapper element is shown by just adding a
<b>name</b> attribute to each <b>collection</b> element.</p>

<a name="figure11"><b>Figure 11. Collections and IDs</b></a><br>
<img src="images/collection-binding2.gif" width="582" height="550" alt="Collections and IDs"/>

<p>I've also added route and flight information to the <a href="#figure11">Figure
11</a> binding. The most interesting part about these additions is the use of
references back to the airport and carrier information. The carrier reference
linkages are highlighted in green, the airport linkages in magenta. In the Java
code, the linkages are direct object references. On the XML side, these are
converted into ID and IDREF links - each carrier or airport defines an ID value,
which is then referenced by flight or route elements. The binding definition
shows these linkages through the use of an <b>ident="def"</b> attribute on the
child <b>value</b> component of a <b>mapping</b> element supplying the ID, and an
<b>ident="ref"</b> attribute on an IDREF <b>value</b> component that references
an ID.</p>

<p>Using ID and IDREF links allows references between objects to be marshalled
and unmarshalled, but is subject to some limitations. Each object with an ID
must have a <b>mapping</b> in the binding. The current JiBX code also requires
that you define objects in some consistent way, though the references to the
objects can be from anywhere (even before the actual definitions
of the objects). In other words, you have to define each object once and only
once. In <a href="#figure11">Figure 11</a> the definitions occur in the
<b>carriers</b> and <b>airports</b> collections. The current code also prohibits
using IDREF values directly within a collection (so the definitions can be from
a collection, but not the references) - to use references in a collection you
need to define some sort of wrapper object that actually holds the reference.
However, see <a href="../extras.html#ididref">JiBX extras</a> for some support classes
which extend the basic JiBX handling in these areas.</p>

<div><p align="center"><a href="binding-mappings.html"><b>Next: The many flavors of mappings</b></a></p></div>

      </div>
      </div>
      </div>


      </td>
    </tr>
  </tbody>
</table>
<div id="footer">
<table border="0" cellspacing="0" cellpadding="4">
  <tbody>
    <tr>
      <td> &copy; 2003-2005, Dennis M. Sosnoski (<a href="http://www.sosnoski.com">Sosnoski Software Solutions, Inc.</a>).
      Licensed to the JiBX Project for free distribution and use. </td>
    </tr>
  </tbody>
</table>
</div>
<br>
</body>
</html>
